<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯µç‰©é¤ŠæˆéŠæˆ²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
        }
        .game-container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; text-align: center; }
        .progress-bar { width: 100%; height: 12px; background-color: #e5e7eb; border-radius: 9999px; overflow: hidden; }
        .progress-fill { height: 100%; transition: width 0.5s ease-in-out, background-color 0.5s ease-in-out; border-radius: 9999px; }
        .action-button { transition: transform 0.1s ease-in-out, background-color 0.3s ease-in-out, opacity 0.3s; user-select: none; cursor: pointer; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1); }
        .action-button:active { transform: scale(0.95); }
        .action-button:disabled { opacity: 0.5; cursor: not-allowed; }
        @keyframes bounce { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .bouncing { animation: bounce 0.3s ease-in-out; }
        .modal { display: none; position: fixed; z-index: 10; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.4); justify-content: center; align-items: center; }
        .modal-content { background-color: #fff; padding: 24px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2); width: 90%; max-width: 400px; }
        #petHouse { background-color: #e0f2fe; border-radius: 1rem; }
        .decoration-item { position: absolute; font-size: 2.5rem; user-select: none; }
        #petCostume { position: absolute; z-index: 6; font-size: 3rem; transform: translate(-50%, -50%); top: 40%; left: 50%; pointer-events: none; }
        @keyframes levelUpAnimation { 0% { opacity: 1; transform: translateY(0) scale(1); } 100% { opacity: 0; transform: translateY(-50px) scale(1.5); } }
        .level-up-effect { position: absolute; z-index: 20; color: #facc15; font-size: 2rem; animation: levelUpAnimation 1.5s ease-out forwards; pointer-events: none; }
    </style>
</head>
<body>

    <div id="gameContainer" class="game-container p-4">
        <!-- ä¸»éŠæˆ²é¢æ¿ -->
        <div id="gamePanel" class="bg-white p-6 sm:p-8 rounded-3xl shadow-2xl max-w-lg w-full border border-gray-200 hidden">
            <h1 class="text-4xl font-bold text-gray-800 mb-4" id="petNameDisplay"></h1>

            <!-- å¯µç‰©ç‹€æ…‹èˆ‡ç­‰ç´š -->
            <div class="flex items-center justify-between text-gray-700 font-bold text-lg mb-2">
                <span id="petLevelDisplay">ç­‰ç´šï¼š1</span>
                <div id="goldCoinDisplay" class="text-sm font-semibold text-amber-500 flex items-center">
                    <span class="text-xl mr-1">ğŸ’°</span> 0
                </div>
            </div>
            <div class="w-full mb-4">
                <div class="flex justify-between items-center mb-1"><span class="text-sm font-semibold text-gray-600">ç¶“é©—å€¼</span><span id="expValue" class="text-sm font-semibold text-gray-600">0/100</span></div>
                <div class="progress-bar"><div id="expFill" class="progress-fill bg-yellow-400"></div></div>
            </div>

            <!-- å¯µç‰©é¡¯ç¤ºå€åŸŸ -->
            <div id="petHouse" class="relative w-full h-48 flex items-center justify-center mb-4">
                <div id="decorationContainer" class="absolute inset-0"></div>
                <div id="petDisplay" class="text-9xl transition-transform duration-200 relative z-[5]">ğŸ±</div>
                <div id="petCostume"></div>
                <div id="dirtDisplay" class="text-5xl absolute bottom-2 right-10 hidden animate-pulse z-10">ğŸ’©</div>
            </div>

            <!-- å¯µç‰©æ•¸å€¼æ¢ -->
            <div class="flex flex-col items-center mb-6 space-y-3">
                <div class="w-full"><div class="flex justify-between items-center mb-1"><span class="text-sm font-semibold text-gray-600">é£½è¶³åº¦</span><span id="hungerValue" class="text-sm font-semibold text-gray-600">100%</span></div><div class="progress-bar"><div id="hungerFill" class="progress-fill bg-green-500"></div></div></div>
                <div class="w-full"><div class="flex justify-between items-center mb-1"><span class="text-sm font-semibold text-gray-600">å¿«æ¨‚åº¦</span><span id="happinessValue" class="text-sm font-semibold text-gray-600">100%</span></div><div class="progress-bar"><div id="happinessFill" class="progress-fill bg-pink-500"></div></div></div>
                <div class="w-full"><div class="flex justify-between items-center mb-1"><span class="text-sm font-semibold text-gray-600">æ¸…æ½”åº¦</span><span id="hygieneValue" class="text-sm font-semibold text-gray-600">100%</span></div><div class="progress-bar"><div id="hygieneFill" class="progress-fill bg-sky-500"></div></div></div>
            </div>

            <!-- æ“ä½œæŒ‰éˆ• -->
            <div class="grid grid-cols-3 gap-2">
                <button id="feedButton" class="action-button bg-blue-500 text-white font-bold py-3 px-2 rounded-xl hover:bg-blue-600">é¤µé£Ÿ</button>
                <button id="playButton" class="action-button bg-pink-500 text-white font-bold py-3 px-2 rounded-xl hover:bg-pink-600">ç©è€</button>
                <button id="cleanButton" class="action-button bg-green-500 text-white font-bold py-3 px-2 rounded-xl hover:bg-green-600">æ¸…æ½”</button>
                <button id="skillButton" class="action-button bg-yellow-500 text-white font-bold py-3 px-2 rounded-xl hover:bg-yellow-600">æŠ€èƒ½</button>
                <button id="decorationButton" class="action-button bg-orange-500 text-white font-bold py-3 px-2 rounded-xl hover:bg-orange-600">è£é£¾</button>
                <button id="shopButton" class="action-button bg-purple-500 text-white font-bold py-3 px-2 rounded-xl hover:bg-purple-600">å•†åº—</button>
            </div>

            <!-- ç‹€æ…‹è¨Šæ¯ -->
            <div id="statusMessage" class="mt-4 text-sm text-gray-500 min-h-[20px] flex items-center justify-center"></div>
        </div>

        <!-- å¯µç‰©é¸æ“‡ç•«é¢ -->
        <div id="petSelectionPanel" class="bg-white p-8 rounded-3xl shadow-2xl max-w-lg w-full border border-gray-200"><h1 class="text-4xl font-bold text-gray-800 mb-6">é¸æ“‡ä½ çš„å¯µç‰©</h1><div class="grid grid-cols-3 gap-4"><button class="select-pet-button p-4 rounded-xl hover:bg-gray-100" data-pet="cat"><div class="text-6xl mb-2">ğŸ±</div><span class="font-semibold text-lg">è²“</span></button><button class="select-pet-button p-4 rounded-xl hover:bg-gray-100" data-pet="dog"><div class="text-6xl mb-2">ğŸ¶</div><span class="font-semibold text-lg">ç‹—</span></button><button class="select-pet-button p-4 rounded-xl hover:bg-gray-100" data-pet="rabbit"><div class="text-6xl mb-2">ğŸ°</div><span class="font-semibold text-lg">å…”</span></button><button class="select-pet-button p-4 rounded-xl hover:bg-gray-100" data-pet="parrot"><div class="text-6xl mb-2">ğŸ¦œ</div><span class="font-semibold text-lg">é¸šéµ¡</span></button><button class="select-pet-button p-4 rounded-xl hover:bg-gray-100" data-pet="hamster"><div class="text-6xl mb-2">ğŸ¹</div><span class="font-semibold text-lg">å€‰é¼ </span></button><button class="select-pet-button p-4 rounded-xl hover:bg-gray-100" data-pet="turtle"><div class="text-6xl mb-2">ğŸ¢</div><span class="font-semibold text-lg">çƒé¾œ</span></button></div></div>

        <!-- å½ˆå‡ºè¦–çª— -->
        <div id="shopModal" class="modal"><div class="modal-content text-center"><h2 class="text-2xl font-bold mb-4">å•†åº—</h2><p class="text-sm text-gray-500 mb-4">ç”¨å¿«æ¨‚åº¦æ›å–å„ç¨®å¥½ç‰©ï¼</p><div id="shopItems" class="grid grid-cols-2 gap-4"></div><button id="closeShopButton" class="mt-6 bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600">é—œé–‰</button></div></div>
        <div id="skillModal" class="modal"><div class="modal-content text-center"><h2 class="text-2xl font-bold mb-4">å¯µç‰©æŠ€èƒ½</h2><p class="text-sm text-gray-500 mb-4">éš¨è‘—ç­‰ç´šæå‡ï¼Œä½ çš„å¯µç‰©æœƒè¶Šä¾†è¶Šå²å®³ï¼</p><div id="skillItems" class="space-y-3 text-left"></div><button id="closeSkillButton" class="mt-6 bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600">é—œé–‰</button></div></div>
        <div id="decorationModal" class="modal"><div class="modal-content text-center"><h2 class="text-2xl font-bold mb-4">è£é£¾å°å±‹</h2><p class="text-sm text-gray-500 mb-4">ç”¨é‡‘å¹£ç‚ºå¯µç‰©æ‰“é€ ä¸€å€‹æº«æš–çš„å®¶ï¼</p><div id="decorationItems" class="grid grid-cols-2 gap-4"></div><button id="closeDecorationButton" class="mt-6 bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600">é—œé–‰</button></div></div>

    </div>

<script>
    // --- å¸¸æ•¸ ---
    const CONSTS = { åŸºç¤é£¢é¤“åº¦ä¸‹é™ç‡: 1.5, åŸºç¤å¿«æ¨‚åº¦ä¸‹é™ç‡: 1, åŸºç¤æ¸…æ½”åº¦ä¸‹é™ç‡: 0.8, æœ€å¤§æ•¸å€¼: 100, é¤µé£Ÿæ•ˆæœ: 20, ç©è€æ•ˆæœ: 15, æ¸…æ½”æ•ˆæœ: 30, æ¯æ¬¡è¡Œå‹•ç¶“é©—å€¼: 10 };

    // --- DOM å…ƒç´  ---
    const dom = {
        é£¢é¤“åº¦æ•¸å€¼: document.getElementById('hungerValue'), é£¢é¤“åº¦å¡«å……æ¢: document.getElementById('hungerFill'), å¿«æ¨‚åº¦æ•¸å€¼: document.getElementById('happinessValue'), å¿«æ¨‚åº¦å¡«å……æ¢: document.getElementById('happinessFill'), æ¸…æ½”åº¦æ•¸å€¼: document.getElementById('hygieneValue'), æ¸…æ½”åº¦å¡«å……æ¢: document.getElementById('hygieneFill'), å¯µç‰©é¡¯ç¤ºå€: document.getElementById('petDisplay'), å¯µç‰©å°å±‹: document.getElementById('petHouse'), å¯µç‰©è£æ‰®: document.getElementById('petCostume'), é«’æ±¡é¡¯ç¤ºå€: document.getElementById('dirtDisplay'), å¯µç‰©åç¨±é¡¯ç¤ºå€: document.getElementById('petNameDisplay'), å¯µç‰©ç­‰ç´šé¡¯ç¤ºå€: document.getElementById('petLevelDisplay'), ç¶“é©—å€¼æ•¸å€¼: document.getElementById('expValue'), ç¶“é©—å€¼å¡«å……æ¢: document.getElementById('expFill'), é¤µé£ŸæŒ‰éˆ•: document.getElementById('feedButton'), ç©è€æŒ‰éˆ•: document.getElementById('playButton'), æ¸…æ½”æŒ‰éˆ•: document.getElementById('cleanButton'), å•†åº—æŒ‰éˆ•: document.getElementById('shopButton'), æŠ€èƒ½æŒ‰éˆ•: document.getElementById('skillButton'), è£é£¾æŒ‰éˆ•: document.getElementById('decorationButton'), ç‹€æ…‹è¨Šæ¯: document.getElementById('statusMessage'), å¯µç‰©é¸æ“‡é¢æ¿: document.getElementById('petSelectionPanel'), éŠæˆ²é¢æ¿: document.getElementById('gamePanel'), é¸æ“‡å¯µç‰©æŒ‰éˆ•å€‘: document.querySelectorAll('.select-pet-button'),
        å•†åº—å½ˆå‡ºè¦–çª—: document.getElementById('shopModal'), é—œé–‰å•†åº—æŒ‰éˆ•: document.getElementById('closeShopButton'), å•†åº—ç‰©å“å®¹å™¨: document.getElementById('shopItems'),
        æŠ€èƒ½å½ˆå‡ºè¦–çª—: document.getElementById('skillModal'), é—œé–‰æŠ€èƒ½æŒ‰éˆ•: document.getElementById('closeSkillButton'), æŠ€èƒ½ç‰©å“å®¹å™¨: document.getElementById('skillItems'),
        è£é£¾å½ˆå‡ºè¦–çª—: document.getElementById('decorationModal'), é—œé–‰è£é£¾æŒ‰éˆ•: document.getElementById('closeDecorationButton'), è£é£¾ç‰©å“å®¹å™¨: document.getElementById('decorationItems'),
        é‡‘å¹£é¡¯ç¤º: document.getElementById('goldCoinDisplay'), è£é£¾å®¹å™¨: document.getElementById('decorationContainer'),
    };
    
    // --- éŠæˆ²è®Šæ•¸ ---
    let gameState = { é£¢é¤“åº¦: CONSTS.æœ€å¤§æ•¸å€¼, å¿«æ¨‚åº¦: CONSTS.æœ€å¤§æ•¸å€¼, æ¸…æ½”åº¦: CONSTS.æœ€å¤§æ•¸å€¼, éŠæˆ²å¾ªç’°è¨ˆæ™‚å™¨: null, ç­‰ç´š: 1, ç›®å‰ç¶“é©—å€¼: 0, å‡ç´šæ‰€éœ€ç¶“é©—å€¼: 100, éŠæˆ²é€²è¡Œä¸­: true, å·²å­¸ç¿’æŠ€èƒ½: [], ç›®å‰å¯µç‰©: null, é‡‘å¹£: 0, å·²è³¼è²·è£é£¾: [], ç›®å‰ç¯€æ—¥è£æ‰®: null };

    // --- éŠæˆ²è³‡æ–™ ---
    const DATA = {
        å¯µç‰©: { cat: { n: 'è²“å’ª', e: 'ğŸ±', s: 'ğŸ˜¿', b: 'ğŸ˜¼', h: 'ğŸ˜»' }, dog: { n: 'ç‹—ç‹—', e: 'ğŸ¶', s: 'ğŸ¥º', b: 'ğŸ•', h: 'ğŸ¥°' }, rabbit: { n: 'å…”å­', e: 'ğŸ°', s: 'ğŸ˜­', b: 'ğŸ‡', h: 'ğŸ¥•' }, parrot: { n: 'é¸šéµ¡', e: 'ğŸ¦œ', s: 'ğŸ˜', b: 'ğŸ¦', h: 'ğŸ¦œ' }, hamster: { n: 'å€‰é¼ ', e: 'ğŸ¹', s: 'ğŸ˜¥', b: 'ğŸ˜‘', h: 'ğŸ˜‹' }, turtle: { n: 'çƒé¾œ', e: 'ğŸ¢', s: 'ğŸ˜°', b: 'ğŸ¤”', h: 'ğŸ¥³' } },
        å•†åº—ç‰©å“: [ { n: 'ç©å…·çƒ', e: 'âš½', c: 20, t: 'å¿«æ¨‚åº¦', v: 30 }, { n: 'è±ªè¯é»å¿ƒ', e: 'ğŸ§', c: 25, t: 'é£½è¶³åº¦', v: 40 }, { n: 'ç¥å¥‡é¦™çš‚', e: 'ğŸ§¼', c: 15, t: 'æ¸…æ½”åº¦', v: 60 }, { n: 'è²“è–„è·', e: 'ğŸŒ¿', c: 30, t: 'å¿«æ¨‚åº¦', v: 50 } ],
        æŠ€èƒ½: [ { id: 'appetite_control', n: 'é£Ÿæ…¾æ§åˆ¶', l: 5, d: 'æ¸›ç·©é£¢é¤“åº¦ä¸‹é™é€Ÿåº¦ 20%ã€‚' }, { id: 'playful_heart', n: 'ç©æ¨‚ä¹‹å¿ƒ', l: 10, d: 'æå‡ç©è€ç²å¾—çš„å¿«æ¨‚åº¦ 25%ã€‚' }, { id: 'self_cleaning', n: 'è‡ªæˆ‘æ¸…æ½”', l: 15, d: 'æ¸›ç·©æ¸…æ½”åº¦ä¸‹é™é€Ÿåº¦ 30%ã€‚' }, { id: 'fast_learner', n: 'å­¸ç¿’ä¹‹æ˜Ÿ', l: 20, d: 'æ¯æ¬¡è¡Œå‹•ç²å¾—é¡å¤– 5 é»ç¶“é©—å€¼ã€‚' } ],
        è£é£¾å“: [ { id: 'bed', n: 'èˆ’é©å°åºŠ', e: 'ğŸ›ï¸', c: 50, p: { bottom: '5px', left: '10px' }, interaction: { stat: 'å¿«æ¨‚åº¦', value: 5, msg: 'ä½ çš„å¯µç‰©åœ¨åºŠä¸Šå°ç¡ç‰‡åˆ»ï¼Œç²¾ç¥å¥½å¤šäº†ï¼' } }, { id: 'plant', n: 'å°ç›†æ ½', e: 'ğŸª´', c: 30, p: { top: '10px', right: '15px' }, interaction: { stat: 'å¿«æ¨‚åº¦', value: 3, msg: 'å¯µç‰©å¥½å¥‡åœ°èäº†èç›†æ ½ã€‚' } }, { id: 'ball', n: 'ç´…è‰²çš®çƒ', e: 'âš½', c: 20, p: { bottom: '15px', right: '20px'}, interaction: { stat: 'å¿«æ¨‚åº¦', value: 10, msg: 'ä½ çš„å¯µç‰©é–‹å¿ƒåœ°ç©è‘—çƒï¼' } }, { id: 'window', n: 'æº«æš–çª—æˆ¶', e: 'ğŸ–¼ï¸', c: 80, p: { top: '5px', left: '5px' } }, { id: 'music_box', n: 'éŸ³æ¨‚ç›’', e: 'ğŸµ', c: 60, p: { top: '50px', right: '10px'}, interaction: { stat: 'å¿«æ¨‚åº¦', value: 8, msg: 'å„ªç¾çš„éŸ³æ¨‚è®“å¯µç‰©å¿ƒæƒ…æ„‰å¿«ï¼' } } ],
        ç¯€æ—¥: [ { month: 11, day: 25, e: 'ğŸ…', name: 'è–èª•ç¯€' }, { month: 9, day: 31, e: 'ğŸƒ', name: 'è¬è–ç¯€' }, { month: 0, day: 1, e: 'ğŸ‰', name: 'æ–°å¹´' }, { month: 8, day: 23, e: 'ğŸ¥³', name: 'æ¸¬è©¦ç¯€æ—¥' } ] // æœˆä»½æ˜¯ 0-11, 8 = ä¹æœˆ
    };

    // --- éŠæˆ²é‚è¼¯ ---
    function è¨ˆç®—æŠ€èƒ½æ•ˆæœ() {
        let eff = { é£¢é¤“åº¦ä¸‹é™ç‡: CONSTS.åŸºç¤é£¢é¤“åº¦ä¸‹é™ç‡, ç•¶å‰ç©è€æ•ˆæœ: CONSTS.ç©è€æ•ˆæœ, æ¸…æ½”åº¦ä¸‹é™ç‡: CONSTS.åŸºç¤æ¸…æ½”åº¦ä¸‹é™ç‡, é¡å¤–ç¶“é©—å€¼: 0 };
        if (gameState.å·²å­¸ç¿’æŠ€èƒ½.includes('appetite_control')) eff.é£¢é¤“åº¦ä¸‹é™ç‡ *= 0.8; if (gameState.å·²å­¸ç¿’æŠ€èƒ½.includes('playful_heart')) eff.ç•¶å‰ç©è€æ•ˆæœ *= 1.25; if (gameState.å·²å­¸ç¿’æŠ€èƒ½.includes('self_cleaning')) eff.æ¸…æ½”åº¦ä¸‹é™ç‡ *= 0.7; if (gameState.å·²å­¸ç¿’æŠ€èƒ½.includes('fast_learner')) eff.é¡å¤–ç¶“é©—å€¼ = 5;
        return eff;
    }

    function æ›´æ–°ä»‹é¢() {
        ['é£¢é¤“åº¦', 'å¿«æ¨‚åº¦', 'æ¸…æ½”åº¦'].forEach(stat => gameState[stat] = Math.min(Math.max(0, gameState[stat]), CONSTS.æœ€å¤§æ•¸å€¼));
        dom.é£¢é¤“åº¦æ•¸å€¼.textContent = `${Math.round(gameState.é£¢é¤“åº¦)}%`; dom.å¿«æ¨‚åº¦æ•¸å€¼.textContent = `${Math.round(gameState.å¿«æ¨‚åº¦)}%`; dom.æ¸…æ½”åº¦æ•¸å€¼.textContent = `${Math.round(gameState.æ¸…æ½”åº¦)}%`;
        dom.ç¶“é©—å€¼æ•¸å€¼.textContent = `${gameState.ç›®å‰ç¶“é©—å€¼}/${gameState.å‡ç´šæ‰€éœ€ç¶“é©—å€¼}`; dom.å¯µç‰©ç­‰ç´šé¡¯ç¤ºå€.textContent = `ç­‰ç´šï¼š${gameState.ç­‰ç´š}`;
        dom.é‡‘å¹£é¡¯ç¤º.innerHTML = `<span class="text-xl mr-1">ğŸ’°</span> ${gameState.é‡‘å¹£}`;
        dom.é£¢é¤“åº¦å¡«å……æ¢.style.width = `${gameState.é£¢é¤“åº¦}%`; dom.å¿«æ¨‚åº¦å¡«å……æ¢.style.width = `${gameState.å¿«æ¨‚åº¦}%`; dom.æ¸…æ½”åº¦å¡«å……æ¢.style.width = `${gameState.æ¸…æ½”åº¦}%`;
        dom.ç¶“é©—å€¼å¡«å……æ¢.style.width = `${(gameState.ç›®å‰ç¶“é©—å€¼ / gameState.å‡ç´šæ‰€éœ€ç¶“é©—å€¼) * 100}%`;
        if (gameState.é£¢é¤“åº¦ > 50) dom.é£¢é¤“åº¦å¡«å……æ¢.style.backgroundColor = '#22c55e'; else if (gameState.é£¢é¤“åº¦ > 20) dom.é£¢é¤“åº¦å¡«å……æ¢.style.backgroundColor = '#f97316'; else dom.é£¢é¤“åº¦å¡«å……æ¢.style.backgroundColor = '#ef4444';
        if (gameState.å¿«æ¨‚åº¦ > 50) dom.å¿«æ¨‚åº¦å¡«å……æ¢.style.backgroundColor = '#ec4899'; else if (gameState.å¿«æ¨‚åº¦ > 20) dom.å¿«æ¨‚åº¦å¡«å……æ¢.style.backgroundColor = '#facc15'; else dom.å¿«æ¨‚åº¦å¡«å……æ¢.style.backgroundColor = '#ef4444';
        if (gameState.æ¸…æ½”åº¦ > 50) dom.æ¸…æ½”åº¦å¡«å……æ¢.style.backgroundColor = '#38bdf8'; else if (gameState.æ¸…æ½”åº¦ > 20) dom.æ¸…æ½”åº¦å¡«å……æ¢.style.backgroundColor = '#a16207'; else dom.æ¸…æ½”åº¦å¡«å……æ¢.style.backgroundColor = '#ef4444';
        
        // æ›´æ–°è£æ‰®
        dom.å¯µç‰©è£æ‰®.textContent = gameState.ç›®å‰ç¯€æ—¥è£æ‰® || '';

        if (!gameState.éŠæˆ²é€²è¡Œä¸­) return;
        dom.é«’æ±¡é¡¯ç¤ºå€.classList.toggle('hidden', gameState.æ¸…æ½”åº¦ >= 30);
        if (gameState.æ¸…æ½”åº¦ < 20) { dom.å¯µç‰©é¡¯ç¤ºå€.textContent = gameState.ç›®å‰å¯µç‰©.s; dom.ç‹€æ…‹è¨Šæ¯.textContent = 'ä½ çš„å¯µç‰©éœ€è¦æ´—æ¾¡äº†ï¼'; } 
        else if (gameState.é£¢é¤“åº¦ < 20 || gameState.å¿«æ¨‚åº¦ < 20) { dom.å¯µç‰©é¡¯ç¤ºå€.textContent = gameState.ç›®å‰å¯µç‰©.s; dom.ç‹€æ…‹è¨Šæ¯.textContent = 'ä½ çš„å¯µç‰©çœ‹èµ·ä¾†å¾ˆä¸é–‹å¿ƒï¼'; } 
        else if (gameState.é£¢é¤“åº¦ < 50 || gameState.å¿«æ¨‚åº¦ < 50 || gameState.æ¸…æ½”åº¦ < 50) { dom.å¯µç‰©é¡¯ç¤ºå€.textContent = gameState.ç›®å‰å¯µç‰©.b; dom.ç‹€æ…‹è¨Šæ¯.textContent = 'ä½ çš„å¯µç‰©ä¼¼ä¹æƒ³è¦é»ä»€éº¼ã€‚'; } 
        else { dom.å¯µç‰©é¡¯ç¤ºå€.textContent = gameState.ç›®å‰å¯µç‰©.h; dom.ç‹€æ…‹è¨Šæ¯.textContent = 'ä½ çš„å¯µç‰©çœ‹èµ·ä¾†å¾ˆé–‹å¿ƒï¼'; }
    }

    function è§¸ç™¼å‡ç´šå‹•ç•«() {
        const effect = document.createElement('div');
        effect.className = 'level-up-effect';
        effect.textContent = 'âœ¨ LEVEL UP! âœ¨';
        dom.å¯µç‰©å°å±‹.appendChild(effect);
        setTimeout(() => {
            effect.remove();
        }, 1500);
    }

    function æª¢æŸ¥å‡ç´š() {
        if (gameState.ç›®å‰ç¶“é©—å€¼ >= gameState.å‡ç´šæ‰€éœ€ç¶“é©—å€¼) {
            gameState.ç­‰ç´š++; gameState.ç›®å‰ç¶“é©—å€¼ -= gameState.å‡ç´šæ‰€éœ€ç¶“é©—å€¼; gameState.å‡ç´šæ‰€éœ€ç¶“é©—å€¼ = gameState.ç­‰ç´š * 100; gameState.é‡‘å¹£ += gameState.ç­‰ç´š * 10;
            é¡¯ç¤ºæš«æ™‚è¨Šæ¯(`æ­å–œï¼å‡åˆ°äº†ç­‰ç´š ${gameState.ç­‰ç´š}ï¼ç²å¾— ${gameState.ç­‰ç´š*10} é‡‘å¹£ï¼`);
            è§¸ç™¼å‡ç´šå‹•ç•«();
            DATA.æŠ€èƒ½.forEach(skill => { if (gameState.ç­‰ç´š >= skill.l && !gameState.å·²å­¸ç¿’æŠ€èƒ½.includes(skill.id)) { gameState.å·²å­¸ç¿’æŠ€èƒ½.push(skill.id); é¡¯ç¤ºæš«æ™‚è¨Šæ¯(`å­¸æœƒäº†æ–°æŠ€èƒ½ï¼š${skill.n}!`, 3000); } });
            æ›´æ–°ä»‹é¢();
        }
    }

    function æª¢æŸ¥éŠæˆ²çµæŸ() {
        if (gameState.é£¢é¤“åº¦ <= 0 || gameState.å¿«æ¨‚åº¦ <= 0 || gameState.æ¸…æ½”åº¦ <= 0) {
            gameState.éŠæˆ²é€²è¡Œä¸­ = false; clearInterval(gameState.éŠæˆ²å¾ªç’°è¨ˆæ™‚å™¨); dom.å¯µç‰©é¡¯ç¤ºå€.textContent = 'ğŸ‘»'; dom.ç‹€æ…‹è¨Šæ¯.textContent = 'ä½ çš„å¯µç‰©é›¢å®¶å‡ºèµ°äº†... è«‹åˆ·æ–°é é¢é‡æ–°é–‹å§‹ã€‚';
            [dom.é¤µé£ŸæŒ‰éˆ•, dom.ç©è€æŒ‰éˆ•, dom.æ¸…æ½”æŒ‰éˆ•, dom.å•†åº—æŒ‰éˆ•, dom.æŠ€èƒ½æŒ‰éˆ•, dom.è£é£¾æŒ‰éˆ•].forEach(btn => btn.disabled = true);
        }
    }

    function éŠæˆ²å¾ªç’°() {
        if (!gameState.éŠæˆ²é€²è¡Œä¸­) return;
        const eff = è¨ˆç®—æŠ€èƒ½æ•ˆæœ(); gameState.é£¢é¤“åº¦ -= eff.é£¢é¤“åº¦ä¸‹é™ç‡; gameState.å¿«æ¨‚åº¦ -= CONSTS.åŸºç¤å¿«æ¨‚åº¦ä¸‹é™ç‡; gameState.æ¸…æ½”åº¦ -= eff.æ¸…æ½”åº¦ä¸‹é™ç‡;
        æ›´æ–°ä»‹é¢(); æª¢æŸ¥éŠæˆ²çµæŸ();
    }

    function æª¢æŸ¥ç¯€æ—¥() {
        const today = new Date();
        const month = today.getMonth();
        const day = today.getDate();
        const currentHoliday = DATA.ç¯€æ—¥.find(h => h.month === month && h.day === day);
        if (currentHoliday) {
            gameState.ç›®å‰ç¯€æ—¥è£æ‰® = currentHoliday.e;
            é¡¯ç¤ºæš«æ™‚è¨Šæ¯(`ä»Šå¤©æ˜¯${currentHoliday.name}ï¼ä½ çš„å¯µç‰©æ›ä¸Šäº†ç‰¹åˆ¥è£æ‰®ï¼`, 4000);
        }
    }

    function é¸æ“‡å¯µç‰©(petId) {
        gameState.ç›®å‰å¯µç‰© = DATA.å¯µç‰©[petId]; dom.å¯µç‰©é¸æ“‡é¢æ¿.classList.add('hidden'); dom.éŠæˆ²é¢æ¿.classList.remove('hidden');
        dom.å¯µç‰©åç¨±é¡¯ç¤ºå€.textContent = gameState.ç›®å‰å¯µç‰©.n; dom.å¯µç‰©é¡¯ç¤ºå€.textContent = gameState.ç›®å‰å¯µç‰©.e;
        æª¢æŸ¥ç¯€æ—¥();
        æ›´æ–°ä»‹é¢(); 
        gameState.éŠæˆ²å¾ªç’°è¨ˆæ™‚å™¨ = setInterval(éŠæˆ²å¾ªç’°, 1000);
    }
    
    function é¡¯ç¤ºæš«æ™‚è¨Šæ¯(msg, time = 2000) { const originalMsg = dom.ç‹€æ…‹è¨Šæ¯.textContent; dom.ç‹€æ…‹è¨Šæ¯.textContent = msg; setTimeout(() => { if (dom.ç‹€æ…‹è¨Šæ¯.textContent === msg) { dom.ç‹€æ…‹è¨Šæ¯.textContent = originalMsg; }}, time); }

    function æ¸²æŸ“å•†åº—() {
        dom.å•†åº—ç‰©å“å®¹å™¨.innerHTML = '';
        DATA.å•†åº—ç‰©å“.forEach(item => {
            const el = document.createElement('div'); el.className = 'flex flex-col items-center bg-gray-50 p-4 rounded-xl cursor-pointer hover:bg-gray-200';
            el.innerHTML = `<div class="text-4xl mb-2">${item.e}</div><div class="font-bold">${item.n}</div><div class="text-sm text-gray-600">è²»ç”¨ï¼š${item.c} å¿«æ¨‚åº¦</div>`;
            el.addEventListener('click', () => {
                if (gameState.å¿«æ¨‚åº¦ >= item.c) {
                    gameState.å¿«æ¨‚åº¦ -= item.c;
                    if(item.t === 'å¿«æ¨‚åº¦') gameState.å¿«æ¨‚åº¦ = Math.min(CONSTS.æœ€å¤§æ•¸å€¼, gameState.å¿«æ¨‚åº¦ + item.v);
                    else if (item.t === 'é£½è¶³åº¦') gameState.é£¢é¤“åº¦ = Math.min(CONSTS.æœ€å¤§æ•¸å€¼, gameState.é£¢é¤“åº¦ + item.v);
                    else if (item.t === 'æ¸…æ½”åº¦') gameState.æ¸…æ½”åº¦ = Math.min(CONSTS.æœ€å¤§æ•¸å€¼, gameState.æ¸…æ½”åº¦ + item.v);
                    é¡¯ç¤ºæš«æ™‚è¨Šæ¯(`ä½ ä½¿ç”¨äº† ${item.n}ï¼`); æ›´æ–°ä»‹é¢(); dom.å•†åº—å½ˆå‡ºè¦–çª—.style.display = 'none';
                } else { é¡¯ç¤ºæš«æ™‚è¨Šæ¯('å¿«æ¨‚åº¦ä¸è¶³ï¼Œç„¡æ³•è³¼è²·ã€‚'); }
            });
            dom.å•†åº—ç‰©å“å®¹å™¨.appendChild(el);
        });
    }

    function æ¸²æŸ“æŠ€èƒ½() {
        dom.æŠ€èƒ½ç‰©å“å®¹å™¨.innerHTML = '';
        DATA.æŠ€èƒ½.forEach(skill => {
            const has = gameState.å·²å­¸ç¿’æŠ€èƒ½.includes(skill.id), can = gameState.ç­‰ç´š >= skill.l, el = document.createElement('div');
            el.className = `p-3 rounded-lg ${has ? 'bg-green-100' : (can ? 'bg-yellow-100' : 'bg-gray-100 opacity-60')}`;
            el.innerHTML = `<div class="font-bold text-gray-800">${skill.n} ${has ? ' (å·²å­¸ç¿’)' : `(Lv.${skill.l} è§£é–)`}</div><div class="text-sm text-gray-600">${skill.d}</div>`;
            dom.æŠ€èƒ½ç‰©å“å®¹å™¨.appendChild(el);
        });
    }
    
    function æ¸²æŸ“è£é£¾() {
        dom.è£é£¾å®¹å™¨.innerHTML = '';
        gameState.å·²è³¼è²·è£é£¾.forEach(decoId => {
            const decoData = DATA.è£é£¾å“.find(d => d.id === decoId);
            const el = document.createElement('div');
            el.className = 'decoration-item';
            el.textContent = decoData.e;
            Object.assign(el.style, decoData.p);
            if (decoData.interaction) {
                el.classList.add('cursor-pointer');
                el.style.transition = 'transform 0.2s ease, opacity 0.5s ease';
                el.addEventListener('click', () => {
                    if (!gameState.éŠæˆ²é€²è¡Œä¸­) return;
                    if (el.classList.contains('on-cooldown')) {
                        é¡¯ç¤ºæš«æ™‚è¨Šæ¯('é€™å€‹å®¶å…·æ­£åœ¨å†·å»ä¸­ï¼');
                        return;
                    }
                    const interaction = decoData.interaction;
                    gameState[interaction.stat] = Math.min(CONSTS.æœ€å¤§æ•¸å€¼, gameState[interaction.stat] + interaction.value);
                    é¡¯ç¤ºæš«æ™‚è¨Šæ¯(interaction.msg);
                    el.style.transform = 'scale(1.2)';
                    setTimeout(() => { el.style.transform = 'scale(1)'; }, 200);
                    el.classList.add('on-cooldown', 'opacity-50');
                    setTimeout(() => { el.classList.remove('on-cooldown', 'opacity-50'); }, 10000);
                    æ›´æ–°ä»‹é¢();
                });
            }
            dom.è£é£¾å®¹å™¨.appendChild(el);
        });
    }
    
    function æ¸²æŸ“è£é£¾å•†åº—() {
        dom.è£é£¾ç‰©å“å®¹å™¨.innerHTML = '';
        DATA.è£é£¾å“.forEach(item => {
            const isOwned = gameState.å·²è³¼è²·è£é£¾.includes(item.id);
            const el = document.createElement('div');
            el.className = `flex flex-col items-center bg-gray-50 p-4 rounded-xl ${isOwned ? 'opacity-50' : 'cursor-pointer hover:bg-gray-200'}`;
            el.innerHTML = `<div class="text-4xl mb-2">${item.e}</div><div class="font-bold">${item.n}</div><div class="text-sm text-gray-600">${isOwned ? 'å·²æ“æœ‰' : `ğŸ’° ${item.c}`}</div>`;
            if (!isOwned) {
                el.addEventListener('click', () => {
                    if (gameState.é‡‘å¹£ >= item.c) {
                        gameState.é‡‘å¹£ -= item.c; gameState.å·²è³¼è²·è£é£¾.push(item.id);
                        é¡¯ç¤ºæš«æ™‚è¨Šæ¯(`è³¼è²·äº† ${item.n}ï¼`); æ¸²æŸ“è£é£¾(); æ›´æ–°ä»‹é¢(); dom.è£é£¾å½ˆå‡ºè¦–çª—.style.display = 'none';
                    } else { é¡¯ç¤ºæš«æ™‚è¨Šæ¯('é‡‘å¹£ä¸è¶³ï¼Œç„¡æ³•è³¼è²·ã€‚'); }
                });
            }
            dom.è£é£¾ç‰©å“å®¹å™¨.appendChild(el);
        });
    }

    function åŸ·è¡Œå¯µç‰©å‹•ä½œ() {
        if (!gameState.éŠæˆ²é€²è¡Œä¸­) return;
        const { é¡å¤–ç¶“é©—å€¼ } = è¨ˆç®—æŠ€èƒ½æ•ˆæœ(); gameState.ç›®å‰ç¶“é©—å€¼ += (CONSTS.æ¯æ¬¡è¡Œå‹•ç¶“é©—å€¼ + é¡å¤–ç¶“é©—å€¼); gameState.é‡‘å¹£ += 1;
        dom.å¯µç‰©é¡¯ç¤ºå€.classList.add('bouncing'); setTimeout(() => dom.å¯µç‰©é¡¯ç¤ºå€.classList.remove('bouncing'), 300);
        æª¢æŸ¥å‡ç´š(); æ›´æ–°ä»‹é¢();
    }

    // --- äº‹ä»¶ç›£è½å™¨ ---
    dom.é¸æ“‡å¯µç‰©æŒ‰éˆ•å€‘.forEach(btn => btn.addEventListener('click', e => é¸æ“‡å¯µç‰©(e.currentTarget.dataset.pet)));
    dom.é¤µé£ŸæŒ‰éˆ•.addEventListener('click', () => { gameState.é£¢é¤“åº¦ = Math.min(CONSTS.æœ€å¤§æ•¸å€¼, gameState.é£¢é¤“åº¦ + CONSTS.é¤µé£Ÿæ•ˆæœ); åŸ·è¡Œå¯µç‰©å‹•ä½œ(); });
    dom.ç©è€æŒ‰éˆ•.addEventListener('click', () => { const { ç•¶å‰ç©è€æ•ˆæœ } = è¨ˆç®—æŠ€èƒ½æ•ˆæœ(); gameState.å¿«æ¨‚åº¦ = Math.min(CONSTS.æœ€å¤§æ•¸å€¼, gameState.å¿«æ¨‚åº¦ + ç•¶å‰ç©è€æ•ˆæœ); åŸ·è¡Œå¯µç‰©å‹•ä½œ(); });
    dom.æ¸…æ½”æŒ‰éˆ•.addEventListener('click', () => { gameState.æ¸…æ½”åº¦ = Math.min(CONSTS.æœ€å¤§æ•¸å€¼, gameState.æ¸…æ½”åº¦ + CONSTS.æ¸…æ½”æ•ˆæœ); åŸ·è¡Œå¯µç‰©å‹•ä½œ(); });
    
    function setupModal(openBtn, modal, closeBtn, renderFn) {
        openBtn.addEventListener('click', () => { if (gameState.éŠæˆ²é€²è¡Œä¸­) { if(renderFn) renderFn(); modal.style.display = 'flex'; } });
        closeBtn.addEventListener('click', () => modal.style.display = 'none');
    }
    setupModal(dom.å•†åº—æŒ‰éˆ•, dom.å•†åº—å½ˆå‡ºè¦–çª—, dom.é—œé–‰å•†åº—æŒ‰éˆ•, æ¸²æŸ“å•†åº—);
    setupModal(dom.æŠ€èƒ½æŒ‰éˆ•, dom.æŠ€èƒ½å½ˆå‡ºè¦–çª—, dom.é—œé–‰æŠ€èƒ½æŒ‰éˆ•, æ¸²æŸ“æŠ€èƒ½);
    setupModal(dom.è£é£¾æŒ‰éˆ•, dom.è£é£¾å½ˆå‡ºè¦–çª—, dom.é—œé–‰è£é£¾æŒ‰éˆ•, æ¸²æŸ“è£é£¾å•†åº—);

</script>

</body>
</html>

